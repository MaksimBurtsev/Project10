## Задание №7. Нагрузка, стресс и отказоустойчивость
___
### Что такое нагрузочное тестирование, тестирование отказоустойчивости и стресс-тестирование? Что их отличает друг от друга?

Нагрузочное тестирование, тестирование отказоустойчивости и стресс-тестирование являются незаменимыми инструментами тестирования производительности систем. При этом каждый вид тестирования имеет свои особенности и используется для различных целей.
____
| Вид тестирования | Определение | Отличия от других видов тестирования |
| --- | --- | --- |
| Нагрузочное тестирование | Тестирование производительности системы при естественном или ожидаемом уровне нагрузки путем увеличения нагрузки на систему с минимальной до максимальной. | Оценка производительности системы при нормальных условиях использования. Не проверяет работу системы при экстремальных условиях. |
| Стресс-тестирование | Тестирование работоспособности системы при крайне высокой нагрузке в течение длительного времени для проверки ее жизнеспособности в условиях интенсивного использования. | Проверка работоспособности системы при экстремальных условиях. Оценка реакции системы на интенсивное использование. |
| Тестирование отказоустойчивости | Тестирование способности системы сохранять работоспособность в условиях сбоя или других неблагоприятных факторов для оценки ее быстрого и правильного реагирования на проблемы, возникающие в процессе работы. | Проверка работоспособности системы в условиях сбоев и других неблагоприятных факторов. Выявление проблемных мест в ее структуре. |
____
**Нагрузочное тестирование**

Нагрузочное тестирование является одним из наиболее важных этапов тестирования производительности системы. Во время такого тестирования тестируются все основные функции системы и ее реакция на определенный уровень нагрузки. Это может помочь выявить возможные слабые места в производительности системы и узнать, как система будет работать в условиях повышенной нагрузки.

Выявление и устранение проблем в производительности системы является критически важным шагом, так как неспособность системы к масштабируемости может привести к трудностям в доступности информации и растущим расходам на оборудование. Нагрузочное тестирование - идеальный способ проверить производительность системы и убедиться в ее готовности к различного рода проблемам и вызовам, которые могут возникнуть в процессе работы.

Для проведения нагрузочного тестирования необходимо выбрать правильную методику тестирования, которая является наиболее эффективной для конкретной системы и ее ресурсов. Это может включать в себя использование "нагрузочных генераторов", которые создают определенные нагрузки на системе, чтобы тестирование производилось в реалистичных условиях.

**Стресс-тестирование**

Стресс-тестирование является уникальным подходом к тестированию системы. Оно позволяет проводить тестирование системы в условиях, которые эмулируют экстремальные условия, такие как очень высокое число пользователей, обращающихся к системе одновременно, или другие весьма неблагоприятные факторы.

Цель проведения стресс-тестирования - определить пределы прочности и производительности системы. Это может помочь узнать, как система будет работать в условиях, которые превысили или будут значительно превышать ее нормальный уровень использования. 

Дополнительный аспект стресс-тестирования - проверка системы на наличие багов, не связанных непосредственно с производительностью. Большинство программных систем имеют пределы своих возможностей, и возможны проблемы при работе в условиях, которые превышают эти пределы.

**Тестирование отказоустойчивости**

Тестирование отказоустойчивости - это часть стресс-тестирования, которая посвящена исследованию возможностей системы в условиях, когда она сталкивается с неблагоприятными факторами. Это может включать в себя проверку системы на наличие багов, которые могут быть вызваны провалами в электропитании, внезапными отключениями оборудования, или вызванными злонамеренным поведением пользователей.

Ключевым аспектом успешного тестирования отказоустойчивости является новый подход к тестированию. Тестирование отказоустойчивости должно быть более точным и полным, чтобы выявить все возможные проблемы в системе и позволить им быть исправленными. 

Тестирование отказоустойчивости охватывает всю структуру системы, включая всех пользователей и программистов. Тестеры должны понимать, какую кодировку используют разработчики, а также знать, какие функции самые чувствительные к сбоям. Один слабый звено может обернуться катастрофическим отказом системы, поэтому определение этих слабых мест имеет первостепенное значение.

Тестирование отказоустойчивости помогает резко повысить надежность и функциональность системы. Если тестирование проведено правильно и его рекомендации были оперативно исправлены, то система может функционировать без сбоев, снизить расходы на техническое обслуживание и увеличить удовлетворенность пользователей.
____
**Отличия между этими видами тестирования** заключаются в разных подходах, используемых при проведении тестирования. Нагрузочное тестирование позволяет выявить лимиты производительности системы и определить ее возможности в нормальных условиях использования. Стресс-тестирование используется для проверки экстремальных ситуаций, которые могут возникнуть в процессе работы системы. Тестирование отказоустойчивости позволяет исследовать работу системы в условиях сбоя или других неблагоприятных факторов и выявить проблемные места в ее структуре. Каждый вид тестирования имеет свои особенности и применяется в соответствии с задачей, которую необходимо решить.
____
**Нагрузочное тестирование (пример)**

Нагрузочное тестирование веб-приложения проводится с целью оценки его способности работать при высокой нагрузке и выявления возможных проблем производительности при обработке большого количества запросов к базе данных. В ходе тестирования проверяются основные показатели, такие как:

• Среднее время отклика веб-приложения при выполнении запросов к БД

• Время выполнения отдельных запросов и операций с 

• Время ответа при выполнении многочисленных запросов при удаленном доступе

• Производительность самых важных операций веб-приложения

• Производительность стандартных и менее важных операций

• Общая производительность системы в базовом 

• Время обработки записей в БД

**Пример проведения нагрузочного тестирования веб-приложения онлайн-банка.** При создании нашего ресурса мы учитываем высокую посещаемость и ставим перед собой цель привлечь не менее 10 тыс. пользователей одновременно. Чтобы обеспечить быстрый и комфортный доступ к нашему веб-сервису, мы устанавливаем такие параметры, как максимальное время отклика сайта не более 3 секунд. Для проверки данного параметра используется нагрузочное тестирование, которое помогает выявить возможные проблемы с откликом при увеличении посетителей. Если отклик превышает ожидаемый уровень, то мы можем столкнуться с торможением работы веб-приложения для нашего онлайн-банка при увеличении нагрузки.

 Для того чтобы удостовериться в том, что наша система готова к такой нагрузке, мы можем выполнить следующие задачи:

• Проектирование архитектуры системы для обеспечения масштабируемости приложения и балансировки нагрузки на серверах

• Создание тестовых сценариев, эмулирующих одновременную авторизацию на сайте, просмотр баланса и выполнение операций по переводу средств

• Параллельное выполнение большого количества запросов на поиск информации о доступных кредитах, ипотечных калькуляторов, информации о банковских услугах

• Оценка времени выполнения различных операций веб-приложения, таких как отправка заявки на получение кредита или подключение дополнительных услуг

Результаты тестирования помогут определить проблемы производительности приложения и узкие места в работе системы. Они также помогут оптимизировать работу приложения и внести необходимые изменения в базу данных и код приложения для достижения более высоких показателей производительности и удовлетворения потребностей клиентов в области функциональности и доступности. В итоге, наше веб-приложение будет способным обеспечивать безопасный и удобный доступ к банковским услугам для нескольких тысяч пользователей одновременно.
____
**Стресс-тестирование  (пример)**

Стресс-тестирование является способом оценки надежности и устойчивости системы, определяющим ее способность обрабатывать большое количество запросов. Это тестирование направлено на поиск критических точек системы, которые могут стать причиной ее отказа при высокой нагрузке. 

В процессе стресс-тестирования система подвергается интенсивной нагрузке с помощью специальных инструментов, таких как LoadRunner и JMeter. Для этого необходимо тщательное планирование времени и ресурсов. Основная цель тестирования - определение точки отказа. 

Для успешного проведения стресс-тестирования необходимо составить список главных функций БД и связанных с ними хранимых процедур. Тестировщик должен написать тестовые сценарии, проверяющие каждую из этих функций, как минимум один раз. 

Выполняя сценарии, мы нагружаем систему большим количеством запросов до достижения результата - определения проблем и узких мест. Один из наиболее распространенных недостатков, определяемых при стресс-тестировании, - утечка памяти, при которой оперативная память системы исчерпывается, ведя к ее отказу. 

После проведения стресс-тестирования необходим анализ лог-файлов с целью выявления утечек памяти, потерь данных и других проблем, которые могут возникнуть при большой нагрузке на систему. 

Для тестирования среднего веб-приложения можно использовать инструменты, такие как Apache JMeter и Gatling. В ходе тестирования необходимо определить список ключевых функций, которые будет проверять система. Это могут быть, например, функции регистрации пользователя, поиска и фильтрации данных, отправки сообщений и т.д.

**Пример:** Проводим стресс-тестирование онлайн магазина, который обрабатывает 1000 запросов в секунду и выдерживает до 50 000 одновременных пользователей. Установим нагрузку на 55 000 пользователей и одновременно запустим сценарий покупки товара с различными параметрами, например, выбором определенного товара, изменением количества или цены, выбором способа доставки и оплаты. Оценим время обработки каждой транзакции и ее успешность. Если система справится с этой нагрузкой, увеличим ее еще на 10% и продолжим тестирование. Если возникнут проблемы, будем анализировать лог-файлы и находить причину возникновения ошибок.
____
**Тестирование отказоустойчивости  (пример)**

Тестирование отказоустойчивости является способом проверки работоспособности системы в условиях ее возможного отказа в процессе обработки запросов. Оно направлено на проверку того, как система будет вести себя при возникновении проблем, таких как сбой в оборудовании, потеря сетевого соединения или другие непредвиденные ситуации.

В процессе тестирования отказоустойчивости система подвергается специальным сценариям сбоев и неполадок, чтобы проверить ее возможность автоматического восстановления работы после возникновения проблемы. Эти тесты могут включать сбросы системы, непреднамеренное отключение питания или сети, изменение конфигурации оборудования и другие типы различных отказов.

Цель тестирования отказоустойчивости - определение, как быстро и эффективно система может восстановить свою работоспособность, без значительного ущерба для пользователей и бизнеса. Оно также позволяет выявить уязвимые места, которые нужно устранить, чтобы обеспечить более высокий уровень отказоустойчивости.

**Например, при тестировании отказоустойчивости веб-сервера**, мы можем создать сценарий, при котором происходит отключение одного из серверов, используемых для балансировки нагрузки. После этого мы можем наблюдать, как система автоматически переключается на другой сервер и продолжает работу без простоев и заметных изменений для пользователей.

```Для проведения тестирования отказоустойчивости необходимо выполнить следующие шаги:```

1. Определение целей и требований тестирования: этот шаг включает определение того, что именно нужно протестировать, какое поведение системы нежелательно, а также какими критериями успеха будет измеряться эффективность тестирования.

2. Создание плана тестирования: в этом шаге перечисляются сценарии, которые нужно будет выполнить при тестировании; определяются исходные условия, такие как количество пользователей, тип запросов и прочее; а также приводятся методы, которые будут использоваться в процессе тестирования.

3. Настройка среды тестирования: в этом шаге настраивается окружение, в котором будет производиться тестирование, включая программное обеспечение, оборудование, сеть и другое.

4. Выполнение тестовых сценариев: на этом этапе проводится само тестирование, включая запуск сценариев тестирования отказоустойчивости и протоколирование результатов.

5. Анализ результатов: здесь производится анализ всех полученных результатов, включая выявление проблем и уязвимых мест системы, а также технических деталей о том, как система ведет себя при возникновении сбоев.

6. Устранение проблем: после тестирования отказоустойчивости необходимо решить все выявленные проблемы, обеспечив нужный уровень защиты от сбоев и снижая вероятность возникновения новых проблем в будущем.

7. Повторное тестирование: после устранения всех проблем следует провести повторное тестирование отказоустойчивости, чтобы убедиться в том, что все проблемы действительно решены и система способна выдержать экстремальные условия без значительных изменений в работе.
После проведения тестирования отказоустойчивости необходимо проанализировать результаты, чтобы выявить все проблемы и уязвимые места системы. После исправления обнаруженных проблем и повторного тестирования можно убедиться в том, что система обладает высокой степенью отказоустойчивости и готова к работе в самых экстремальных условиях.
____

### C помощью каких инструментов можно провести нагрузочное тестирование базы данных?

|**Инструмент** | **Описание** |
|------------|----------|
| **Apache JMeter** | Бесплатный инструмент для тестирования производительности, позволяет симулировать одновременную работу нескольких пользователей и отправку большого количества запросов в базу данных. |
| **LoadRunner** | Инструмент для тестирования производительности, используемый для создания и запуска нагрузочных тестов на различных приложениях, включая базы данных. Платный инструмент. |
| **NeoLoad** | Инструмент для автоматизации тестирования производительности, который позволяет создавать и запускать нагрузочные тесты на базах данных и веб-приложениях. Платный инструмент. |
| **WebLOAD** | Инструмент для тестирования производительности, который позволяет создавать и запускать нагрузочные тесты на базах данных и веб-приложениях. Платный инструмент. |
| **Tsung** | Бесплатный инструмент для тестирования производительности, который позволяет эмулировать тысячи пользователей и отправлять им запросы в базу данных. |
| **Gatling** | Инструмент для тестирования производительности, который позволяет создавать и запускать нагрузочные тесты на базах данных и веб-приложениях. Бесплатный инструмент с открытым исходным кодом. |
| **Httperf** | Бесплатный инструмент для тестирования производительности, который позволяет генерировать нагрузочные тесты на базы данных и анализировать результаты тестирования. |
| **Apache Bench** | Бесплатный инструмент для тестирования производительности, который позволяет отправлять запросы в базу данных и анализировать результаты тестирования. |

Все перечисленные инструменты могут использоваться для тестирования нагрузки на базу данных. Они различаются по возможностям и стоимости. Apache JMeter и Tsung являются бесплатными и позволяют проводить нагрузочное тестирование базы данных. LoadRunner, NeoLoad и WebLOAD являются платными инструментами с расширенными возможностями. Gatling, Httperf и Apache Bench также являются бесплатными инструментами для тестирования производительности, но они могут быть менее функциональными по сравнению с платными аналогами.
____

| **Способ** | **Описание** |
|--------|----------|
| **Индексация базы данных** | Индексация позволяет быстро находить информацию в больших базах данных. Она создает дополнительные структуры для быстрого доступа к данным. Индексы могут быть созданы на одном или нескольких полях таблицы. Они позволяют ускорить операции выборки данных, такие как SELECT и JOIN. Однако, индексация может сказаться на производительности при выполнении операций INSERT, UPDATE и DELETE. Также, создание слишком многих индексов может привести к снижению производительности всей базы данных. |
| **Улучшение вычислительных мощностей самого** | Улучшение вычислительных мощностей самого сервера - это процесс улучшения железных характеристик сервера, таких как процессор, память и дисковая система. Это позволяет увеличить производительность сервера и повысить скорость работы базы данных. Улучшение вычислительных мощностей сервера является одним из эффективных способов оптимизации производительности базы данных. |
| **Выделение больше памяти** | Выделение больше памяти - это процесс увеличения объема доступной памяти для базы данных. Для этого можно установить дополнительные модули памяти на сервер, использовать распределенную базу данных или виртуальную память. Увеличение доступной памяти позволяет ускорить выполнение запросов и повысить скорость работы базы данных. Увеличение объема памяти особенно важно для работ с большими объемами данных или для работы с многопользовательскими системами. |
| **Оптимизация** | Оптимизация запросов является одним из наиболее эффективных способов улучшения производительности баз данных. Этот процесс включает в себя анализ и улучшение конструкции запросов для уменьшения издержек при выполнении запросов. Например, использование подзапросов может быть эффективнее, чем выполнение нескольких запросов с JOIN. Важно также использовать индексы и другие способы для ускорения выполнения запросов. |
| **Использование хранимых** | Хранимые процедуры - это набор команд SQL, которые могут быть сохранены в базе данных и вызваны при необходимости. Они позволяют уменьшить количество запросов, отправляемых к базе данных, что приводит к уменьшению задержки и повышению производительности. Также они могут быть легко оптимизированы и изменены, если это необходимо. |
| **Оптимизация памяти и управление ею** | В случае больших баз данных важно понимать, как использовать память, чтобы оптимизировать производительность системы. Это может включать в себя управление кэшем, настройку параметров системы и оптимизацию работы с оперативной памятью. Так, настройка памяти буфера может увеличить производительность базы данных, за счет того, что избегаются повторяющиеся запросы к диску. |
| **Повышение быстродействия дисковой системы** | База данных должна быть установлена на высокоскоростном устройстве хранения данных, чтобы быстро доступиться к данным и файлам библиотек. Также можно использовать RAID или другие технологии, которые позволяют увеличить скорость и надежность хранения данных. |
| **Выделение большего числа ядер процессора для работы с базой данных** | Большинство современных баз данных могут использовать несколько ядер процессора, что позволяет увеличить производительность базы данных. Использование нескольких ядер процессора может существенно повысить скорость выполнения запросов и других операций в базе данных. |
| **Использование кэшей для ускорения доступа к повторяющимся запросам** | Кэширование - это процесс сохранения данных в памяти, чтобы они были быстро доступны. Кэш можно использовать для ускорения доступа к данным, которые часто запрашиваются. Размер кэша должен быть подобран таким образом, чтобы существенно повысить производительность при минимуме занятого места. |
| **Оптимизация настройки пакетов операционной системы** | Настройки операционной системы могут влиять на производительность баз данных. Например, можно настроить параметры пакетов, такие как максимальный размер сегмента TCP, чтобы значительно повысить скорость передачи данных. |
| **Внедрение механизмов репликации и кластеризации баз данных** | Репликация - это процесс копирования и синхронизации данных с несколькими серверами баз данных. Это может увеличить доступность и производительность базы данных. Кластеризация - это создание группы серверов, которые работают вместе, чтобы обеспечить такие функции, как балансировка нагрузки и отказоустойчивость. |
| **Проверка системных настроек на соответствие оптимальным требованиям работы с базой данных** | Наконец, критически важно проверять настройки операционной системы и аппаратное обеспечение, чтобы убедиться в их соответствии оптимальным требованиям для работы с базами данных. Например, для базы данных могут потребоваться дополнительные ресурсы, такие как оперативная память и процессоры. Необходимо также отслеживать изменения и регулярно проверять, что все параметры настроек соответствуют требованиям производительности. |